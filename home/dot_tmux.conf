set-option -sa terminal-overrides ",xterm*:Tc"
set -g mouse on

# https://github.com/xiantang/darcula-dark.nvim#troubleshooting
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# https://dev.to/anurag_pramanik/how-to-enable-undercurl-in-neovim-terminal-and-tmux-setup-guide-2ld7
# Undercurl support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# unbind C-b
# set -g prefix C-Space
# bind C-Space send-prefix

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Prevent windows from remaining on exit
set -g remain-on-exit off

# Perform aggressive resizing
setw -g aggressive-resize on

set -g allow-passthrough on

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?\.?(view|n?vim?x?|fzf)(-wrapped)?(diff)?$'"

# Ctrl-hjkl for navigation

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }

bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'

# Use Alt-arrow keys without prefix key to resize panes

bind -n 'M-h' if-shell "$is_vim" 'send-keys M-h' 'resize-pane -L 1'
bind -n 'M-j' if-shell "$is_vim" 'send-keys M-j' 'resize-pane -D 1'
bind -n 'M-k' if-shell "$is_vim" 'send-keys M-k' 'resize-pane -U 1'
bind -n 'M-l' if-shell "$is_vim" 'send-keys M-l' 'resize-pane -R 1'

bind-key -T copy-mode-vi M-h resize-pane -L 1
bind-key -T copy-mode-vi M-j resize-pane -D 1
bind-key -T copy-mode-vi M-k resize-pane -U 1
bind-key -T copy-mode-vi M-l resize-pane -R 1

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# Shift Alt vim keys to switch windows
bind -n M-H previous-window
bind -n M-L next-window

# Install plugins with prefix + I

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'oluevaera/tmux-conda-inherit'

# https://github.com/christoomey/vim-tmux-navigator#restoring-clear-screen-c-l
# With this enabled you can use <prefix> C-l to clear the screen.
bind C-l send-keys 'C-l'

# Copy to the system clipboard in tmux.
set -g @plugin 'tmux-plugins/tmux-yank'

# Prefix + j - jump
set -g @plugin 'schasse/tmux-jump'

# prefix + space - select actions from a customizable popup menu
set -g @plugin 'alexwforsythe/tmux-which-key'

# Prefix + Ctrl-s - save
# Prefix + Ctrl-r - restore
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'

set -g @plugin 'sainnhe/tmux-fzf'

# The default binding uses o so prefix + o will run the process to find files in
# the current pane output.
set -g @plugin 'Peter-McKinney/tmux-open-file-nvim'

# Themes
# sset -g @plugin 'wabri/tmux-nord-plusplus'
set -g @plugin 'dreamsofcode-io/catppuccin-tmux'
set -g @catppuccin_flavour 'mocha'
# set -g @plugin 'samharju/tmux-synthweave-theme'
# set -g @plugin 'rose-pine/tmux'

# set vi-mode
set-window-option -g mode-keys vi
# keybindings

# https://hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/#sane-split-commands
# split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# https://hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/#easy-config-reloads
# reload config file
bind r source-file ~/.tmux.conf

# https://github.com/akinomyoga/ble.sh/wiki/Manual-%C2%A73-Key-Binding#354-timeout-of-the-terminal-multiplexer-tmux-tmuxconf
set -sg escape-time 1

# https://github.com/Geekdude/dotfiles/blob/master/tmux.conf

# Prefix + [ to begin copy mode
# Prefix + ] to paste copied text


bind -T copy-mode-vi v send-keys -X begin-selection           # Begin selection in copy mode.
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle        # Begin selection in copy mode.
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel # Yank selection in copy mode.

# View yank history: prefix + #

run-shell ~/.tmux/plugins/tmux-jump/tmux-jump.tmux
run-shell ~/.tmux/plugins/tmux-resurrect/resurrect.tmux

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
